# pywps web processing service
upstream {{ wps_name }} {
    # socket connection
    server unix:///var/run/{{ wps_name }}.socket fail_timeout=0;
}

server {
    listen {{ wps_port }} default_server;
    listen [::]:{{ wps_port }} default_server;
    server_name _;

    # better to redirect / to wps application
    location / {
      return 301 /wps;
    }

    # PyWPS avail at /wps
    location /wps {
        proxy_pass              http://{{ wps_name }};
        proxy_set_header        X-Forwarded-Ssl on;
        proxy_set_header        X-Forwarded-Host $host/wps/;
        proxy_set_header        X-Forwarded-Server $host;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect          off;
        proxy_buffering         on;
        client_max_body_size    64m;
        proxy_read_timeout      30s;
    }

    # PyWPS Outputs
    location /outputs
    {
        alias /var/lib/pywps/outputs;
        autoindex off;
    }

}
